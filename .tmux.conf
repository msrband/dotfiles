# ===== 기본 설정 =====
# 인덱스 1부터 시작 (0은 키보드에서 멀어서)
set -g base-index 1
set -g pane-base-index 1

# Vi 스타일 키 바인딩
set -g status-keys vi
setw -g mode-keys vi

# 히스토리 크기
set -g history-limit 10000

# Escape 지연 최소화 (Neovim 권장)
set -sg escape-time 10

# Focus events (Neovim 등에서 필요)
set -g focus-events on

# ===== 터미널 설정 =====
set -g default-terminal "tmux-256color"

# True color 및 기타 터미널 기능
set -ag terminal-features ',xterm-ghostty:RGB:usstyle'
set -ag terminal-features ',tmux-256color:RGB:usstyle'

# Kitty graphics protocol passthrough (이미지 지원)
set -g allow-passthrough all

# 환경 변수 업데이트
set -ga update-environment 'TERM TERM_PROGRAM'

# ===== 클립보드 설정 =====
# OSC 52 클립보드 지원
set -g set-clipboard on

# Paste 시 데이터 손실 방지
set -g assume-paste-time 0

# ===== Prefix 키 설정 =====
# Ctrl-a를 prefix로 사용 (Ctrl-b보다 누르기 편함)
set -g prefix C-a
unbind C-b
bind C-a send-prefix

# 설정 리로드
bind R source-file ~/.tmux.conf \; display-message "tmux.conf reloaded."

# ===== 상태바 설정 =====
set -g status on
set -g status-interval 1
set -g status-justify left
set -g status-bg '#343d46'
set -g status-fg default

# 왼쪽 상태바
set -g status-left-length 60
set -g status-left "#{?client_prefix,#[fg=#ffffff bg=blue],#[fg=#5F5B66 bg=#ffffff]} #S #{?client_prefix,#[fg=blue bg=#343D46],#[fg=#ffffff bg=#343D46]} "

# 오른쪽 상태바
set -g status-right-length 180
set -g status-right " #{mail}  ⓛ   #(ifconfig | grep 'inet ' | tail -n 1 | cut -d ' ' -f 2)  \\  %m/%d, %l:%M  #{cpu_icon}#{cpu_percentage}  #{battery_icon} #{battery_percentage} "

# 윈도우 상태바
set -g window-status-format " #[fg=white bg=#343D46] #I  #{?window_activity_flag,#[fg=#fac863 bg=#343D46],#[fg=white bg=#343D46]} #W "
setw -g window-status-current-format " #[fg=#343D46 bg=blue]#[fg=#ffffff bg=blue] #I  #[fg=#ffffff bg=blue bold] #W #[fg=blue bg=#343D46]"

# ===== Pane 설정 =====
set -g pane-active-border-style fg='#343d46'
set -g pane-border-style fg='#343d46'

# ===== 알림 설정 =====
setw -g monitor-activity on
set -g visual-activity off

# ===== Copy mode (Vi 스타일) =====
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi y send-keys -X copy-selection
bind -T copy-mode-vi r send-keys -X rectangle-toggle

# 시스템 클립보드에서 직접 붙여넣기 (Ghostty paste 버그 우회)
# Ctrl-a P (대문자 P)로 사용
bind P run-shell "pbpaste | tmux load-buffer - && tmux paste-buffer"

# ===== 플러그인 설정 =====
set -g @batt_discharging_icon "❇"
